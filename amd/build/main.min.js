define(["jquery","core/ajax","core/notification","core/str","core/url","core/modal_factory","core/modal_events"],function(o,e,r,t,a,n,l){return{debug:!1,enrolmentrole:function(e){console.log("block_edureportbook/main.enrolmentrole(roleid)",e);var r=this,t=o("#id_roletoassign");0===t.length?setTimeout(function(){r.enrolmentrole(e)},100):o(t).val(e)},participantsform:function(t){console.log("block_edureportbook/partipantsform(courseid)",t),MAIN=this,e.call([{methodname:"block_edureportbook_participantsform",args:{courseid:t},done:function(e){console.log("Got modal"),o("#block_edureportbook_participantsform").remove(),n.create({type:n.types.SAVE_CANCEL,body:e,large:1}).done(function(e){console.log("Created modal"),MAIN.modal=e;o(MAIN.modal.body);MAIN.modal.setLarge(),MAIN.modal.getRoot().on(l.save,function(o){MAIN.participantsstore(MAIN.modal),o.preventDefault()}),MAIN.modal.show()})},fail:r.exception}])},participantsstore:function(t){MAIN=this,console.log("block_edureportbook/partipantsstore(modal)",t);for(var a=o(t.body).find("form"),n=a.serializeArray(),l={},i=0;i<n.length;i++)if(n[i].name.indexOf("[")>0){var s=n[i].name.split("["),c=s[1].split("]"),d=c[0],p=s[0];"undefined"==typeof l[p]&&(l[p]=[]),""!=d?l[p][d]=n[i].value:l[p][l[p].length]=n[i].value}else"_qf__force_multiselect_submission"!=n[i].value&&(l[n[i].name]=n[i].value);e.call([{methodname:"block_edureportbook_participantsstore",args:{data:JSON.stringify(l)},done:function(o){console.log("Got result",o),1==o?MAIN.modal.hide():alert("Sorry, there was an error!")},fail:r.exception}])},removeblock:function(o){console.log("block_edureportbook/removeblock(courseid)",o),MAIN=this,e.call([{methodname:"block_edureportbook_removeblock",args:{courseid:o},done:function(e){console.log("Got result",e),1==e?top.location.href=a.fileUrl("/course/view.php","")+"?id="+o:alert("Sorry, there was an error!")},fail:r.exception}])},separateform:function(t){console.log("block_edureportbook/separateform(courseid)",t),MAIN=this,e.call([{methodname:"block_edureportbook_separateform",args:{courseid:t},done:function(e){console.log("Got modal"),o("#block_edureportbook_separateform").remove(),n.create({type:n.types.SAVE_CANCEL,body:e,large:1}).done(function(e){console.log("Created modal"),MAIN.modal=e;o(MAIN.modal.body);MAIN.modal.setLarge(),MAIN.modal.getRoot().on(l.save,function(o){MAIN.separatestore(MAIN.modal),o.preventDefault()}),MAIN.modal.show()})},fail:r.exception}])},separatestore:function(a){MAIN=this,console.log("block_edureportbook/separatestore(modal)",a);for(var n=o(a.body).find("form"),l=n.serializeArray(),i={},s=0;s<l.length;s++)if(l[s].name.indexOf("[")>0){var c=l[s].name.split("["),d=c[1].split("]"),p=d[0],m=c[0];"undefined"==typeof i[m]&&(i[m]=[]),""!=p?i[m][p]=l[s].value:i[m][i[m].length]=l[s].value}else i[l[s].name]=l[s].value;console.log("Sending data",i),e.call([{methodname:"block_edureportbook_separatestore",args:{data:JSON.stringify(i)},done:function(o){a.hide(),t.get_strings([{key:"separate:error",component:"block_edureportbook"},{key:"separate:success",component:"block_edureportbook"},{key:"separate",component:"block_edureportbook"}]).done(function(e){r.alert(e[2],1==o?e[1]:e[0])}).fail(r.exception)},fail:r.exception}])}}});
