define(["jquery","core/ajax","core/notification","core/str","core/url","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){return{enrolmentrole:function(b){console.log("block_edureportbook/main.enrolmentrole(roleid)",b);var c=this,d=a("#id_roletoassign");0===d.length?setTimeout(function(){c.enrolmentrole(b)},100):a(d).val(b)},participantsform:function(d){console.log("block_edureportbook/partipantsform(courseid)",d),MAIN=this,b.call([{methodname:"block_edureportbook_participantsform",args:{courseid:d},done:function(b){console.log("Got modal"),a("#block_edureportbook_participantsform").remove(),f.create({type:f.types.SAVE_CANCEL,body:b,large:1}).done(function(b){console.log("Created modal"),MAIN.modal=b;a(MAIN.modal.body);MAIN.modal.setLarge(),MAIN.modal.getRoot().on(g.save,function(a){MAIN.participantsstore(MAIN.modal),a.preventDefault()}),MAIN.modal.show()})},fail:c.exception}])},participantsstore:function(d){MAIN=this,console.log("block_edureportbook/partipantsstore(modal)",d);for(var e=a(d.body).find("form"),f=e.serializeArray(),g={},h=0;h<f.length;h++)if(f[h].name.indexOf("[")>0){var i=f[h].name.split("["),j=i[1].split("]"),k=j[0],l=i[0];"undefined"==typeof g[l]&&(g[l]=[]),""!=k?g[l][k]=f[h].value:g[l][g[l].length]=f[h].value}else g[f[h].name]=f[h].value;console.log("Sending data",g),b.call([{methodname:"block_edureportbook_participantsstore",args:{data:JSON.stringify(g)},done:function(a){console.log("Got result",a),1==a?MAIN.modal.hide():alert("Sorry, there was an error!")},fail:c.exception}])},removeblock:function(a){console.log("block_edureportbook/removeblock(courseid)",a),MAIN=this,b.call([{methodname:"block_edureportbook_removeblock",args:{courseid:a},done:function(b){console.log("Got result",b),1==b?top.location.href=e.fileUrl("/course/view.php","")+"?id="+a:alert("Sorry, there was an error!")},fail:c.exception}])},separateform:function(d){console.log("block_edureportbook/separateform(courseid)",d),MAIN=this,b.call([{methodname:"block_edureportbook_separateform",args:{courseid:d},done:function(b){console.log("Got modal"),a("#block_edureportbook_separateform").remove(),f.create({type:f.types.SAVE_CANCEL,body:b,large:1}).done(function(b){console.log("Created modal"),MAIN.modal=b;a(MAIN.modal.body);MAIN.modal.setLarge(),MAIN.modal.getRoot().on(g.save,function(a){MAIN.separatestore(MAIN.modal),a.preventDefault()}),MAIN.modal.show()})},fail:c.exception}])},separatestore:function(e){MAIN=this,console.log("block_edureportbook/separatestore(modal)",e);for(var f=a(e.body).find("form"),g=f.serializeArray(),h={},i=0;i<g.length;i++)if(g[i].name.indexOf("[")>0){var j=g[i].name.split("["),k=j[1].split("]"),l=k[0],m=j[0];"undefined"==typeof h[m]&&(h[m]=[]),""!=l?h[m][l]=g[i].value:h[m][h[m].length]=g[i].value}else h[g[i].name]=g[i].value;console.log("Sending data",h),b.call([{methodname:"block_edureportbook_separatestore",args:{data:JSON.stringify(h)},done:function(a){e.hide(),d.get_strings([{key:"separate:error",component:"block_edureportbook"},{key:"separate:success",component:"block_edureportbook"},{key:"separate",component:"block_edureportbook"}]).done(function(b){c.alert(b[2],1==a?b[1]:b[0])}).fail(c.exception)},fail:c.exception}])}}});